cmake_minimum_required(VERSION 2.6)
project(CalX)

set(wxWidgets_USE_LIBS)
if (WIN32)
	set(wxWidgets_EXCLUDE_COMMON_LIBRARIES true)
	if (CMAKE_BUILD_TYPE EQUAL DEBUG)
		set(wxWidgets_CONFIGURATION  mswud)
	else (CMAKE_BUILD_TYPE EQUAL DEBUG)
		set(wxWidgets_CONFIGURATION  mswu)
	endif (CMAKE_BUILD_TYPE EQUAL DEBUG)
	find_package(wxWidgets COMPONENTS mono)
else (WIN32)
	set(wxWidgets_USE_UNICODE ON)
	if (CMAKE_BUILD_TYPE EQUAL DEBUG)
		set(wxWidgets_USE_DEBUG ON)
	else (CMAKE_BUILD_TYPE EQUAL DEBUG)
		set(wxWidgets_USE_DEBUG OFF)
	endif (CMAKE_BUILD_TYPE EQUAL DEBUG)
	find_package(wxWidgets)
endif (WIN32)

if (wxWidgets_FOUND)
	include(${wxWidgets_USE_FILE})
	include_directories(${CMAKE_SOURCE_DIR})
	include_directories(${CMAKE_CURRENT_SOURCE_DIR})
	file(GLOB_RECURSE SRCS *.cpp ${CMAKE_SOURCE_DIR}/cli/CLI.cpp ${CMAKE_SOURCE_DIR}/cli/DevCLI.cpp)
	add_executable(calxui ${SRCS})
	if(WIN32)
		set_target_properties(calxui PROPERTIES LINK_FLAGS "/SUBSYSTEM:WINDOWS")
		if (CMAKE_BUILD_TYPE EQUAL DEBUG)
			file(GLOB wxDll ${wxWidgets_LIB_DIR}/wxmsw[0-9][0-9][0-9]ud_vc_custom.dll)
		else (CMAKE_BUILD_TYPE EQUAL DEBUG)
			file(GLOB wxDll ${wxWidgets_LIB_DIR}/wxmsw[0-9][0-9][0-9]u_vc_custom.dll)
		endif (CMAKE_BUILD_TYPE EQUAL DEBUG)
		file(COPY ${wxDll} DESTINATION ${CMAKE_BINARY_DIR})
		install(FILES ${wxDll} DESTINATION / COMPONENT wxlibs)
		set(CPACK_COMPONENT_WXLIBS_DISPLAY_NAME "wxWidgets libraries" CACHE INTERNAL "")
		set(CPACK_COMPONENT_WXLIBS_GROUP "Libraries" CACHE INTERNAL "")
		set(CPACK_COMPONENT_WXLIBS_DESCRIPTION "wxWidgets user interface libraries. See <https://www.wxwidgets.org/>" CACHE INTERNAL "")
	endif(WIN32)
	target_link_libraries(calxui ${wxWidgets_LIBRARIES} calx)
	if (WIN32)
		install(TARGETS calxui DESTINATION / COMPONENT calxui)
	else (WIN32)
		install(TARGETS calxui DESTINATION bin COMPONENT calxui)
	endif (WIN32)
	set(CPACK_COMPONENT_CALXUI_DISPLAY_NAME "CalX User interface" CACHE INTERNAL "")
	set(CPACK_COMPONENT_CALXUI_DEPENDS calx_ctrl_lib wxlibs CACHE INTERNAL "")
	set(CPACK_COMPONENT_CALXUI_GROUP "User interface" CACHE INTERNAL "")
	set(CPACK_COMPONENT_CALXUI_DESCRIPTION "Graphics User interface." CACHE INTERNAL "")

else(wxWidgets_FOUND)
	message("wxWidgets not found!")
endif(wxWidgets_FOUND)

